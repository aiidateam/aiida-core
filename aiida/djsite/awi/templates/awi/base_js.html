{% load staticfiles %}
<script>
	/* because we use django's url module, we need this script to be in a template */
	/* we need to be able to access those urls from external scripts */
	var api_urls = {
		computers: '{% url "api_dispatch_list" api_name="v1" resource_name="dbcomputer" %}',
		calculations: '{% url "api_dispatch_list" api_name="v1" resource_name="dbnode" %}',
		attributes: '{% url "api_dispatch_list" api_name="v1" resource_name="attribute" %}',
		authinfo: '{% url "api_dispatch_list" api_name="v1" resource_name="dbauthinfo" %}',
		user: '{% url "api_dispatch_detail" api_name="v1" resource_name="user" pk=0 %}'
	};
	var modules_urls = {
		computers : {
			listing: '{% url "api_dispatch_list" api_name="v1" resource_name="dbcomputer" %}',
			detail: '{% url "awi:computers_detail" computer_id="0" %}',
			apidetail: '{% url "api_dispatch_detail" api_name="v1" resource_name="dbcomputer" pk=0 %}',
			edit: '{% url "awi:computers_edit" computer_id="0" %}',
			schema: '{% url "api_get_schema" api_name="v1" resource_name="dbcomputer" %}'
		},
		calculations : {
			listing: '{% url "api_dispatch_list" api_name="v1" resource_name="dbnode" %}?type__startswith=calculation.',
			detail: '{% url "awi:calculations_detail" calculation_id="0" %}',
			attribute: '{% url "api_dispatch_detail" api_name="v1" resource_name="attribute" pk=0 %}',
			apidetail: '{% url "api_dispatch_detail" api_name="v1" resource_name="dbnode" pk=0 %}'
		},
		filters : {
			computers: {
				get: '{% url "awi:filters_get" module="computers" %}',
				set: '{% url "awi:filters_set" module="computers" field="0" %}',
				remove: '{% url "awi:filters_remove" module="computers" field="0" %}',
				querystring: '{% url "awi:filters_querystring" module="computers" %}',
				create: '{% url "awi:filters_create" module="computers" field="0" %}',
				value: '{% url "awi:filters_value" module="computers" field="0" %}',
				schema: '{% url "api_get_schema" api_name="v1" resource_name="dbcomputer" %}'
			},
			calculations: {
				get: '{% url "awi:filters_get" module="calculations" %}',
				set: '{% url "awi:filters_set" module="calculations" field="0" %}',
				remove: '{% url "awi:filters_remove" module="calculations" field="0" %}',
				querystring: '{% url "awi:filters_querystring" module="calculations" %}',
				create: '{% url "awi:filters_create" module="calculations" field="0" %}',
				value: '{% url "awi:filters_value" module="calculations" field="0" %}',
				schema: '{% url "api_get_schema" api_name="v1" resource_name="dbnode" %}'
			}
		}
	};
	
	// sending a csrftoken with every ajax request
	function csrfSafeMethod(method) {
		// these HTTP methods do not require CSRF protection
		return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
	}
	$.ajaxSetup({
		crossDomain: false, // obviates need for sameOrigin test
		beforeSend: function (xhr, settings) {
			if (!csrfSafeMethod(settings.type)) {
				xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
			}
		}
	});
	
	$(document).ready(function () {
		/* SVG alternative for IE8 and below */
		if (!Modernizr.svg) {
			$(".navbar-brand img").attr('src', "{% static 'awi/img/logo.png' %}");
		}
		$('span').tooltip();
	});
</script>