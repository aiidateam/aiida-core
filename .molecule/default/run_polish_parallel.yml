- name: start polish notation workchains
  shell: |
    {{ venv_bin }}/verdi -p {{ aiida_backend }} run "{{ polish_script }}" -X {{ aiida_add_code }}! -C -F -d -t {{ polish_timeout }} "{{ polish_expr }}"
  environment:
    PYTHONPATH: "{{ aiida_pythonpath }}"
  loop: "{{ polish_expressions }}"
  loop_control:
    loop_var: polish_expr
  async: 611
  poll: 0
  register: async_results

- name: Wait for polish workchains to finish
  async_status:
    jid: "{{ async_result_item.ansible_job_id }}"
  loop: "{{ async_results.results }}"
  loop_control:
    loop_var: "async_result_item"
  register: async_poll_results
  until: async_poll_results.finished
  retries: 30
  delay: 15

- name: print polish workchains stdout
  debug:
    var: async_poll_results.results | map(attribute='stdout', default='')
